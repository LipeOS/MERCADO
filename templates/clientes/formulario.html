{% extends "base.html" %}

{% block title %}{{ 'Editar' if cliente else 'Novo' }} Cliente - Mercadinho{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
<!-- Adicionando SweetAlert para alertas bonitos -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{% endblock %}

{% block content %}
<div class="container">
    <div class="card">
        <div class="card-header">
            <h4>{{ 'Editar' if cliente else 'Cadastrar' }} Cliente</h4>
        </div>
        <div class="card-body">
            <form method="POST" id="form-cliente">
                <div class="form-group">
                    <label for="nome_completo">Nome Completo *</label>
                    <input type="text" class="form-control" id="nome_completo" name="nome_completo" 
                           value="{{ cliente.nome_completo if cliente }}" required
                           minlength="3" maxlength="100">
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="telefone">Telefone *</label>
                            <input type="tel" class="form-control" id="telefone" name="telefone" 
                                   value="{{ cliente.telefone if cliente }}" 
                                   pattern="[0-9]{10,11}" 
                                   title="Digite apenas números (10 ou 11 dígitos)" required>
                            <small class="form-text text-muted">Digite apenas números (10 ou 11 dígitos)</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="cpf">CPF *</label>
                            <input type="text" class="form-control" id="cpf" name="cpf" 
                                   value="{{ cliente.cpf if cliente }}"
                                   pattern="[0-9]{11}"
                                   title="Digite apenas números (11 dígitos)" required>
                            <small class="form-text text-muted">Digite apenas números (11 dígitos)</small>
                        </div>
                    </div>
                </div>

                <div class="form-group mt-3">
                    <button type="submit" class="btn btn-primary">
                        {{ 'Atualizar' if cliente else 'Cadastrar' }}
                    </button>
                    <a href="{{ url_for('listar_clientes') }}" class="btn btn-secondary">Cancelar</a>
                    
                    {% if cliente %}
                    <button type="button" onclick="confirmarExclusao({{ cliente.id }})" 
                            class="btn btn-danger float-right">
                        <i class="bi bi-trash"></i> Excluir
                    </button>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function confirmarExclusao(id) {
    Swal.fire({
        title: 'Tem certeza?',
        text: "Você está prestes a excluir este cliente permanentemente!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Sim, excluir!',
        cancelButtonText: 'Cancelar'
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = `/clientes/excluir/${id}`;
        }
    })
}
</script>
{% endblock %}